<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark"  type="image/x-icon"  href="/img/logo_miccall.png"/>
	 <link rel="shortcut icon" href="/img/logo_miccall.png">
	
			
    <title>
    个人技术博客
    </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/css/mic_main.css" />
    <link rel="stylesheet" href="/css/dropdownMenu.css" />
    
    	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css" />
    </noscript>

			    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
</head>
    
		
<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_coy.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo">过客丶肖</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">主页</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">分类</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/技术/">技术</a></li><li><a class="category-link" href="/categories/爱好/">爱好</a>
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        <li class="active">
	            <a href="#s1">归档</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="archive-link" href="/archives/2017/04/">April 2017</a></li><li><a class="archive-link" href="/archives/2017/03/">March 2017</a></li><li><a class="archive-link" href="/archives/2016/02/">February 2016</a>
	                    </ul>
	        </li>
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/about/" title="简历">
		                简历
		            </a>
		        </li>
		        
		        <li>
		            <a href="/group/" title="团队">
		                团队
		            </a>
		        </li>
		        
		        <li>
		            <a href="/gallery/" title="图库">
		                图库
		            </a>
		        </li>
		        
		        <li>
		            <a href="/tag/" title="标签">
		                标签
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
		            
		                <li><a href="https://github.com/xiaosineng?tab=repositories" class="icon fa-github"><span class="label">GitHub</span></a></li>
		            
		            
		            
		            
			</ul>
</nav>

        <div id="main" >
            <div class ="post_page_title_img" style="height: 25rem;background-image: url(http://img.hb.aicdn.com/ec320c0a93dff671ccd746ed95b56bf130c8fa8621c5c-MjFweC_fw658);background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;" >
                <a href="#" style="padding: 4rem 4rem 2rem 4rem ;"><h2 >nodejs学习笔记（三）</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 3rem;">
                <h2 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h2><h3 id="请求-amp-响应"><a href="#请求-amp-响应" class="headerlink" title="请求&amp;响应"></a>请求&amp;响应</h3><h3 id="querystring去解析键值对的字符串-参数"><a href="#querystring去解析键值对的字符串-参数" class="headerlink" title="querystring去解析键值对的字符串(参数)"></a>querystring去解析键值对的字符串(参数)</h3><pre><code>1、获取GET/POST 传递过来的参数
    GET : URL
    POST : 两个事件data，end

2、再利用querystring解析
</code></pre><h3 id="GET-amp-POST"><a href="#GET-amp-POST" class="headerlink" title="GET&amp;POST"></a>GET&amp;POST</h3><pre><code>传参的方式
参数限制不一样
安全性
</code></pre><hr>
<h2 id="fs"><a href="#fs" class="headerlink" title="fs"></a>fs</h2><h3 id="fs读取文件"><a href="#fs读取文件" class="headerlink" title="fs读取文件"></a>fs读取文件</h3><pre><code>fs.readFileSync 通过返回值获取值
fs.readFile 通过回调函数获取值
</code></pre><h3 id="fs操作文件夹和文件"><a href="#fs操作文件夹和文件" class="headerlink" title="fs操作文件夹和文件"></a>fs操作文件夹和文件</h3><pre><code>文件剪切
    1、监控源文件的更改 watchFile
    2、读取源文件的内容(readFile)，写入到目标文件（writeFile）
    3、写入到目标文件完毕后(unlink)
</code></pre><h3 id="同步-amp-异步"><a href="#同步-amp-异步" class="headerlink" title="同步&amp;异步"></a>同步&amp;异步</h3><pre><code>相同点:
    都能获取结果

不同点:
    1、执行时机
    2、拿到结果的方式

实际工作中如何抉择
    耗时操作用异步
</code></pre><hr>
<h2 id="自定义模块"><a href="#自定义模块" class="headerlink" title="自定义模块"></a>自定义模块</h2><h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><pre><code>核心模块 REPL
第三方包 安装了之后，再导入使用
自定义模块 核心模块中没有，第三方也没有
</code></pre><h3 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a>CommonJS</h3><pre><code>1、先定义模块中的内容，暴露出去
    module.exports = {} 暴露多个成员
    module.exports = 唯一需要暴露出去的成员

2、如果要是用自定义模块，使用require(&apos;../../.js&apos;)，路径最好写全
</code></pre><h3 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h3><pre><code>一般在写代码的过程中，我们把一个模块的功能，就定义在一个单独的js文件中
</code></pre><hr>
<h1 id="今日目标"><a href="#今日目标" class="headerlink" title="今日目标"></a>今日目标</h1><h2 id="发布自定义模块"><a href="#发布自定义模块" class="headerlink" title="发布自定义模块"></a>发布自定义模块</h2><h3 id="自定义模块的写法-计算器"><a href="#自定义模块的写法-计算器" class="headerlink" title="自定义模块的写法(计算器)"></a>自定义模块的写法(计算器)</h3><pre><code>add.js 加法模块 定义了两个成员，导出成对象

substrict.js 减法模块 唯一一个函数

calc.js 一个通用的暴露出去的模块
</code></pre><h3 id="发布到npmjs的要求"><a href="#发布到npmjs的要求" class="headerlink" title="发布到npmjs的要求"></a>发布到npmjs的要求</h3><pre><code>1、注册npmjs账号(需要邮件验证)

2、写好我们自定义的模块(计算器模块---已经完成了)

3、必须在当前我们发布的模块的根目录下，有一个package.json这个是必须的
</code></pre><h3 id="包的规则"><a href="#包的规则" class="headerlink" title="包的规则"></a>包的规则</h3><pre><code>package.json 属性的说明
    name:&quot;包名称&quot;
    main:当通过requrie关键字，导入我们calc_szhm08，它去找哪一个文件

生成:
    npm init [-y]

注意点：
    xxx.json不要写注释，否则会出现莫名其妙的问题
</code></pre><h3 id="如何发布到npmjs-com-使用npm指令发布"><a href="#如何发布到npmjs-com-使用npm指令发布" class="headerlink" title="如何发布到npmjs.com(使用npm指令发布)"></a>如何发布到npmjs.com(使用npm指令发布)</h3><pre><code>1、切换到我们要发布的自定义模块的根目录

2、使用 npm adduser 来登陆到http://www.npmjs.com上面去
    npm adduser 只要一输入就会提示你输入用户名&amp;密码&amp;邮箱，注意所有终端里面的密码都没有字符串提示，输完，按住回车即可

3、npm publish，这个时候就可以将我们自定义模块文件夹下面的所有内容发布到npmjs.com上面去

4、如果以后升级新版本，一定要把版本号改掉，这个版本好只能增不能减，还是使用npm publish发布即可

5、从npmjs下架某个包    
    npm unpublish calc_szhm08@版本

补充：
    查看某一个包的具体信息 npm info 包的名称
</code></pre><h3 id="cnpm"><a href="#cnpm" class="headerlink" title="cnpm"></a>cnpm</h3><pre><code>安装方式：npm i cnpm -g

cnpm是淘宝技术团队出的一个用来下载第三方包的一个全局包

cnpm用法和npm一模一样

什么时候用cnpm&amp;npm 
    你网速好就用npm
    网速不好cnpm，如果有些包从npmjs.com老是下载不了或是下载失败，就是用cnpm
</code></pre><hr>
<h2 id="服务端-器-渲染-动态生成网页"><a href="#服务端-器-渲染-动态生成网页" class="headerlink" title="服务端(器)渲染/动态生成网页"></a>服务端(器)渲染/动态生成网页</h2><h3 id="服务端渲染流程介绍"><a href="#服务端渲染流程介绍" class="headerlink" title="服务端渲染流程介绍"></a>服务端渲染流程介绍</h3><pre><code>1、开启web服务，监听浏览器请求，明白用户的意图(通过路径)

2、利用fs模块(path)模块，读取服务器硬盘某个文件夹下面的index.html

3、获取数据(后面来源于数据库)

4、利用html结构和数据动态生成完整的网页

5、返回给浏览器去呈现
</code></pre><h3 id="原先实现动态网页【了解】"><a href="#原先实现动态网页【了解】" class="headerlink" title="原先实现动态网页【了解】"></a>原先实现动态网页【了解】</h3><pre><code>步骤：和上面分析的一样

上面这个例子，总共发送两次请求
    第一次是请求index.html
    第二次是请求site.css

注意点:    
    1、我们在index.html中发送site.css的时候，可以省略IP和端口，路径不能省略，`/`不能省略，`/`是路径开始的标识

    2、服务端在返回site.css样式的时候，一定要在Content-Type里面设置正确，否则效果出不来    
</code></pre><h3 id="xtemplate-amp-xtpl"><a href="#xtemplate-amp-xtpl" class="headerlink" title="xtemplate&amp;xtpl"></a>xtemplate&amp;xtpl</h3><pre><code>目的:简化我们自己手工拼接html带来的麻烦

模版引擎的原理
    1、写好模版占位(每个模版引擎的语法是不一样的)
    2、利用数据，替换模版中的占位的东西，生成html结构

使用步骤:
    1、安装 xtemplate xtpl 这两个第三方包
        npm i xtemplate xtpl --save

    2、xtemplate用在页面上(index.html)写那个模版语法的
        参考:
            https://github.com/xtemplate/xtemplate/blob/master/docs/syntax-cn.md

    3、xtpl在node后台提供数据，来渲染xtemplate写的模版语法，得到一个html结构
        参考:https://github.com/xtemplate/xtpl

注意点:
    1、这两个第三方包要一起使用，如果只用其中的一个不好使，必须两个同时使用
    2、xtemplate使用在html中，写模版语法的
    3、xtpl用于node后台，用真实的数据替换页面中写的那个模版语法，最终生成html结构
</code></pre><h3 id="音乐播放器完成"><a href="#音乐播放器完成" class="headerlink" title="音乐播放器完成"></a>音乐播放器完成</h3><pre><code>分两大块完成
    1、当用于输入 `http://127.0.0.1:6688/list.html`，让他能看到播放列表的页面
        步骤:
            1、安装 xtemplate xtpl 这两个第三方包
                pm i xtemplate xtpl --save

            2、使用xtemplate来写list.html中的模版语法的代码
                见代码    

            3、使用xtpl在node后台，用真实的数据，来替换模版中写的语法
                见代码

    2、当点击每一行的播放链接的时候，让其听到声音
        步骤:
            1、在list.html中要有一个audio标签，当我们点击了播放连接，就切换audio标签的src(它就会发送网络请求)

            2、当服务器接收到了你的某个请求 http://127.0.0.1:8899/statics/musics/1.mp3 ，后台就需要服务器的硬盘的某个文件夹下面，找到1.mp3，然后将1.mp3的音频流返回给浏览器的audio，就会听到优美的音乐了

    注意点:
        浏览器会默认对我们url中的中文或是特殊字符进行URL编码，后台语言（java,php,node）都能解码
            node 是使用querystring.unescape 来进行URL解码
</code></pre><hr>
<h2 id="require"><a href="#require" class="headerlink" title="require"></a>require</h2><pre><code>作用:
    加载模块，既可以加载核心模块，也可以加载第三方模块，还可以加载自定义模块(.js，.json)

加载规则【了解】
    1、有缓存的，无论是核心模块还是第三方模块还是自定义模块，都有缓存

    2、当我们使用require去加载第三方包的时候，它去找第三方包有一个规则，他会一层一层往外找，直到找到node_modules为止，然后再去node_modules里面找
</code></pre><hr>
<h2 id="mongodb数据库安装"><a href="#mongodb数据库安装" class="headerlink" title="mongodb数据库安装"></a>mongodb数据库安装</h2><pre><code>json---&gt;操作
window7 32位
</code></pre><h3 id="安装服务端"><a href="#安装服务端" class="headerlink" title="安装服务端"></a>安装服务端</h3><pre><code>下一步下一步，选择complete
</code></pre><h3 id="启动服务端"><a href="#启动服务端" class="headerlink" title="启动服务端"></a>启动服务端</h3><pre><code> 1、配置环境变量
     Path : C:\Program Files\MongoDB\Server\3.4\bin

     验证是否安装成功:mongo -version

 2、在c盘根目录下，创建一个文件夹(装我们数据库产生的数据的)

3、执行启动指令
    64位: mongod --dbpath c:/mongodb_datas
    32位: mongod --dbpath c:/mongodb_datas --journal --storageEngine=mmapv1
</code></pre><h3 id="安装客户端"><a href="#安装客户端" class="headerlink" title="安装客户端"></a>安装客户端</h3><pre><code>下一步下一步
</code></pre><hr>

            </div>

            <!-- Post Comments -->
            
    <!-- 使用 DISQUS_CLICK -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>

<!-- add animation -->
<style>
	.disqus_click_btn {
            line-height: 30px;
            margin: 0;
            min-width: 50px;
            padding: 0 14px;
            display: inline-block;
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
            font-size: 14px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0;
            overflow: hidden;
            will-change: box-shadow;
            transition: box-shadow .2s cubic-bezier(.4, 0, 1, 1), background-color .2s cubic-bezier(.4, 0, .2, 1), color .2s cubic-bezier(.4, 0, .2, 1);
            outline: 0;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            vertical-align: middle;
            border: 0;
            background: rgba(158, 158, 158, .2);
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, .14), 0 3px 1px -2px rgba(0, 0, 0, .2), 0 1px 5px 0 rgba(0, 0, 0, .12);
            color: #fff;
            background-color: #7EC0EE;
            text-shadow: 0
        }
</style>
	
<div class="btn_click_load" id="disqus_bt"> 
    <button class="disqus_click_btn">点击查看评论</button>
</div>

<!--
<script type="text/javascript">
$('.btn_click_load').click(function() {
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'http-miccall-tech'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    document.getElementById('disqus_bt').style.display = "none";
});
</script>
-->
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://yoursite.com/2017/04/10/NodeJS第三天笔记/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://yoursite.com/2017/04/10/NodeJS第三天笔记/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>

<script type="text/javascript">
    $('.btn_click_load').click(function() {  //click to load comments
        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document;
            var s = d.createElement('script');
            s.src = '//http-miccall-tech.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
        })();
        $('.btn_click_load').css('display','none');
    });
</script>
</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>


        </div>
        <!-- Copyright 版权 start -->
                <div id="copyright">
            <ul>
                <li>&copy;Powered By <a href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
                <li>Design: <a href="http://miccall.tech " style="border-bottom: none;">miccall</a></li>
            </ul>
            
            	<span id="busuanzi_container_site_pv">2017总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
        </div>
    </div>
</body>



 	
</html>
